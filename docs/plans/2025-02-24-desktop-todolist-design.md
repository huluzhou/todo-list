# Windows 桌面极简 Todolist 设计文档

> 设计日期：2025-02-24

## 1. 目标与约束

- **平台**：Windows 桌面应用
- **形态**：独立半透明小窗口，可拖动、置顶可切换、记住位置、固定大小
- **功能**：极简增删查改待办，支持完成状态；默认开机启动
- **技术选型**：Tauri + 本地 JSON 存储

## 2. 架构概览

**技术栈**

- **Tauri 2.x**：Rust 后端 + 系统 WebView2
- **前端**：HTML + CSS + 少量 JS（或轻量框架）
- **数据**：单文件 JSON，路径为应用数据目录下的 `todos.json`（如 `%AppData%/<应用名>/todos.json`）

**职责划分**

- **Rust**：窗口创建与行为（半透明、置顶、记位、可拖、固定大小）、读写 `todos.json` 与 `window.json`、开机启动（启动文件夹或 Run 注册表）
- **前端**：纯 UI 与交互，通过 Tauri invoke 调用后端；不直接访问文件系统

**数据格式**

- 待办：`{ "id": string, "text": string, "done": boolean, "order": number }`
- 窗口配置（记位 + 置顶偏好）：`window.json`，含 `x`、`y`、`alwaysOnTop` 等

## 3. 界面与交互

**整体**

- 无边框、半透明背景、圆角（可选）、固定宽高（如 320×400），可拖动标题区域移动。

**列表**

- 每条一行：左侧完成状态勾选框，中间文案，右侧删除按钮。
- **完成状态**：勾选 = 已完成，未勾 = 未完成；已完成项可用灰字/删除线区分，仍可取消完成、编辑、删除。
- **单条超长文案**：换行显示全文，不截断；保存时保留完整内容，不做字数上限。

**增**

- 顶部或底部输入框 +「添加」或回车，提交后调用 Tauri 写入，前端刷新列表。

**删**

- 每条右侧删除按钮，点击后调用 Tauri 删除并写回 JSON。

**查**

- 启动时前端调用 `load_todos`，按 `order` 渲染；一屏展示全部，无分页/搜索。

**改**

- 点击文案进入编辑（行内输入框或小浮层），保存时调用 Tauri 更新并写回；可取消。

**置顶可切换**

- 在可拖动区域放小按钮，点击切换「始终置顶」/「不置顶」；状态写入 `window.json`，下次启动恢复。

## 4. 数据流与持久化

**路径**

- `todos.json`、`window.json` 均放在 Tauri `app_data_dir()` 下；首次运行由 Rust 创建目录。

**读**

- 启动时前端调用 `load_todos`；文件不存在或解析失败时返回 `[]`。

**写**

- 增/删/改后前端调用 `save_todos` 传入完整列表，Rust 写回 `todos.json`。窗口位置与置顶偏好在变化时写 `window.json`。

**兼容**

- 读入时缺字段则补默认值：缺 `id` 则生成，缺 `text` 用空串，缺 `done` 为 `false`，缺 `order` 用下标。

## 5. 窗口行为与开机启动

**窗口**

- 无边框、半透明、固定大小、可拖动（前端提供拖动区）；创建后根据 `window.json` 设置位置与置顶。

**记位**

- 窗口移动后写 `window.json`；启动时读取并做简单边界检查（窗口至少部分在屏幕内）。

**开机启动**

- 通过启动文件夹或 `HKCU\...\Run` 注册表添加 exe；提供「开机启动」开关，关闭时移除。

## 6. 错误处理与测试

**错误**

- 读 JSON 失败 → 返回 `[]`，不弹窗。
- 写 JSON 失败 → 前端提示「保存失败，请重试」，列表保持内存状态。
- 开机启动写入失败 → 静默或简短提示，不影响主功能。

**边界**

- 空列表正常显示；多显示器/DPI 下对窗口位置做校验，避免跑出屏幕。

**测试**

- 以在 Windows 上手动验证为主：启动、增删改查、完成状态、置顶开关、记位、拖动、重启后数据与位置、开机启动。可选：Rust 侧 JSON 读写单元测试。
